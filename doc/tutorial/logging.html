

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Logging &mdash; libstephen 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="libstephen 0.1 documentation" href="../index.html"/>
        <link rel="up" title="Libstephen Tutorial" href="index.html"/>
        <link rel="next" title="Unit Testing" href="unittest.html"/>
        <link rel="prev" title="Argument Parsing" href="args.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> libstephen
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Libstephen Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="errors.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="arraylist.html">Array List (smb_al)</a></li>
<li class="toctree-l2"><a class="reference internal" href="linkedlist.html">Linked List</a></li>
<li class="toctree-l2"><a class="reference internal" href="list.html">List Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="iterator.html">Iterator</a></li>
<li class="toctree-l2"><a class="reference internal" href="hashtable.html">Hash Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="charbuf.html">Character Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="args.html">Argument Parsing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#history">History</a></li>
<li class="toctree-l3"><a class="reference internal" href="#goals">Goals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#concepts">Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functions-macros">Functions &amp; Macros</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="unittest.html">Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="regex.html">Regular Expressions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Libstephen API Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">libstephen</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Libstephen Tutorial</a> &raquo;</li>
      
    <li>Logging</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorial/logging.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="logging">
<h1>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h1>
<div class="code C highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;libstephen/log.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<ul class="simple">
<li><a class="reference external" href="https://github.com/brenns10/libstephen/blob/master/inc/libstephen/log.h">Header
(master)</a></li>
<li><a class="reference external" href="https://github.com/brenns10/libstephen/blob/master/src/log.c">Implementation
(master)</a></li>
</ul>
<p>Logging is a very useful way to record messages about your program&#8217;s
operation so you can debug it later. Since C&#8217;s debugging tools are
rather difficult (encouraging so-called <code class="docutils literal"><span class="pre">printf</span></code> debugging), having a
sane logging setup that can be turned on or off easily is important.
Libstephen provides a very nice logging system that satisfies these
requirements. It is inspired by Python&#8217;s logging system, but somewhat
simpler.</p>
<div class="section" id="history">
<h2>History<a class="headerlink" href="#history" title="Permalink to this headline">¶</a></h2>
<p>When I first created Libstephen, I wanted a way to produce debugging
printouts and disable them when I didn&#8217;t need them. I came up with a
macro (<code class="docutils literal"><span class="pre">SMB_DP</span></code>) that would expand to <code class="docutils literal"><span class="pre">printf</span></code> when <code class="docutils literal"><span class="pre">DEBUG</span></code> was
defined, or else expand to nothing. This worked well (so long as I
didn&#8217;t rely on any side effects of expressions within the arguments!).
However, as I started to link to and use Libstephen within other
projects, I ran into issues with this system.</p>
<p>First was that if client code linked to a debug build of Libstephen, it
could get a flood of output from my own logging (that was enabled for
debugging). Second, I began to need more control over logging. There was
no control for enabling logging for just certain modules, or just
messages of a certain priority. That is what inspired me to build a
Python-like logging framework.</p>
</div>
<div class="section" id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h2>
<p>I focused on the following development goals:</p>
<ul class="simple">
<li>In the common case, the logger should be a drop-in replacement for
<code class="docutils literal"><span class="pre">printf</span></code>. It shouldn&#8217;t require much extra typing or arguments.</li>
<li>There should be levels of &#8220;priority&#8221;, from fine grained debugging
output, to critical errors only. You should be able to set how much
your logger shows.</li>
<li>Logging output should be able to be handled by multiple handlers
(files). These handlers should be allowed to set their own log levels
in addition to the logger.</li>
<li>Log messages should tell you exactly where in the code they came
from. In Emacs&#8217; compilation mode, you should be able to hit enter on
a log message and go directly to its source.</li>
</ul>
</div>
<div class="section" id="concepts">
<h2>Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h2>
<p>The logging system is made up of loggers (<code class="docutils literal"><span class="pre">smb_logger</span></code>), which are
collections of log handlers (<code class="docutils literal"><span class="pre">smb_loghandler</span></code>), along with a log
level. Log handlers have their own log level, and they have a file
associated with them. The logging system also has a single &#8220;default&#8221;
logger, which is used when you don&#8217;t specify a logger. At startup, the
default logger will report any level message to <code class="docutils literal"><span class="pre">stderr</span></code>.</p>
<p>The log levels are defined as macros expanding to integers:</p>
<div class="code C highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define LEVEL_NOTSET    0</span>
<span class="cp">#define LEVEL_DEBUG    10</span>
<span class="cp">#define LEVEL_INFO     20</span>
<span class="cp">#define LEVEL_WARNING  30</span>
<span class="cp">#define LEVEL_ERROR    40</span>
<span class="cp">#define LEVEL_CRITICAL 50</span>
</pre></div>
</div>
<p>You can log at any integer level, so these levels are just suggestions,
but they come with nice macros for logging.</p>
</div>
<div class="section" id="functions-macros">
<h2>Functions &amp; Macros<a class="headerlink" href="#functions-macros" title="Permalink to this headline">¶</a></h2>
<p>You can create a <code class="docutils literal"><span class="pre">smb_logger</span></code> using the default lifetime functions
(<code class="docutils literal"><span class="pre">sl_*</span></code>), which take no extra arguments. You can use the following
functions to adjust loggers:</p>
<div class="code C highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">sl_set_level</span><span class="p">(</span><span class="n">smb_logger</span> <span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">sl_add_handler</span><span class="p">(</span><span class="n">smb_logger</span> <span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="n">smb_loghandler</span> <span class="n">h</span><span class="p">,</span> <span class="n">smb_status</span> <span class="o">*</span><span class="n">status</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">sl_clear_handlers</span><span class="p">(</span><span class="n">smb_logger</span> <span class="o">*</span><span class="n">l</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">sl_set_default_logger</span><span class="p">(</span><span class="n">smb_logger</span> <span class="o">*</span><span class="n">l</span><span class="p">);</span>
</pre></div>
</div>
<p>Each of these functions can take <code class="docutils literal"><span class="pre">NULL</span></code> in order to reference the
default logger. As you can see, you can also set the default logger so
that code that logs to the default logger will use your own instead. If
you call <code class="docutils literal"><span class="pre">sl_set_default_logger(NULL)</span></code>, the default logger should be
completely reset to defaults.</p>
<p>Once you have your loggers (which you don&#8217;t have to do immediately,
since you could just use the default logger), you can use the <code class="docutils literal"><span class="pre">LOG</span></code>
macro to begin logging:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">LOG</span><span class="p">(</span><span class="n">pointer</span> <span class="n">to</span> <span class="n">logger</span><span class="p">,</span> <span class="n">log</span> <span class="n">level</span><span class="p">,</span> <span class="s">&quot;format string&quot;</span><span class="p">,</span> <span class="n">format</span> <span class="n">args</span><span class="p">...)</span>
</pre></div>
</div>
<p>This is a macro, so in general avoid using side effects within the
arguments. The current implementation will not evaluate expressions more
than once, but I make no guarantee about that.</p>
<p>If you&#8217;re using the default logger, you have the following shortcuts:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">DDEBUG</span><span class="p">(</span><span class="s">&quot;format string&quot;</span><span class="p">,</span> <span class="n">format</span> <span class="n">args</span> <span class="p">...)</span>
<span class="n">DINFO</span><span class="p">(</span><span class="s">&quot;format string&quot;</span><span class="p">,</span> <span class="n">format</span> <span class="n">args</span> <span class="p">...)</span>
<span class="n">DWARNING</span><span class="p">(</span><span class="s">&quot;format string&quot;</span><span class="p">,</span> <span class="n">format</span> <span class="n">args</span> <span class="p">...)</span>
<span class="n">DERROR</span><span class="p">(</span><span class="s">&quot;format string&quot;</span><span class="p">,</span> <span class="n">format</span> <span class="n">args</span> <span class="p">...)</span>
<span class="n">DCRITICAL</span><span class="p">(</span><span class="s">&quot;format string&quot;</span><span class="p">,</span> <span class="n">format</span> <span class="n">args</span> <span class="p">...)</span>
</pre></div>
</div>
<p>Think of the <code class="docutils literal"><span class="pre">D</span></code> as standing for Default. If you are using any other
logger, you have these shortcuts:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">LDEBUG</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s">&quot;format string&quot;</span><span class="p">,</span> <span class="n">format</span> <span class="n">args</span> <span class="p">...)</span>
<span class="n">LINFO</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s">&quot;format string&quot;</span><span class="p">,</span> <span class="n">format</span> <span class="n">args</span> <span class="p">...)</span>
<span class="n">LWARNING</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s">&quot;format string&quot;</span><span class="p">,</span> <span class="n">format</span> <span class="n">args</span> <span class="p">...)</span>
<span class="n">LERROR</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s">&quot;format string&quot;</span><span class="p">,</span> <span class="n">format</span> <span class="n">args</span> <span class="p">...)</span>
<span class="n">LCRITICAL</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="s">&quot;format string&quot;</span><span class="p">,</span> <span class="n">format</span> <span class="n">args</span> <span class="p">...)</span>
</pre></div>
</div>
<p>Think of the <code class="docutils literal"><span class="pre">L</span></code> as standing for Logger. You have to specify your
logger.</p>
<p>All of these macros expand to call a single function:</p>
<div class="code C highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">sl_log</span><span class="p">(</span><span class="n">smb_logger</span> <span class="o">*</span><span class="n">l</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">function</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="p">...);</span>
</pre></div>
</div>
<p>You don&#8217;t want to call this function yourself, since most of those
arguments (file, line, function) are provided by preprocessor arguments.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="unittest.html" class="btn btn-neutral float-right" title="Unit Testing" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="args.html" class="btn btn-neutral" title="Argument Parsing" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2016, Stephen Brennan.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>