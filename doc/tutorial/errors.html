

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Error Handling &mdash; libstephen 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="libstephen 0.1 documentation" href="../index.html"/>
        <link rel="up" title="Libstephen Tutorial" href="index.html"/>
        <link rel="next" title="Array List (smb_al)" href="arraylist.html"/>
        <link rel="prev" title="Libstephen Tutorial" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> libstephen
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Libstephen Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Error Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#why-a-pointer-to-a-status-variable">Why a pointer to a status variable?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#values">Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#memory-allocation-errors">Memory allocation errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assertions">Assertions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="arraylist.html">Array List (smb_al)</a></li>
<li class="toctree-l2"><a class="reference internal" href="linkedlist.html">Linked List</a></li>
<li class="toctree-l2"><a class="reference internal" href="list.html">List Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="iterator.html">Iterator</a></li>
<li class="toctree-l2"><a class="reference internal" href="hashtable.html">Hash Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="charbuf.html">Character Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="args.html">Argument Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="unittest.html">Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="regex.html">Regular Expressions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Libstephen API Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">libstephen</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Libstephen Tutorial</a> &raquo;</li>
      
    <li>Error Handling</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorial/errors.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="error-handling">
<h1>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h1>
<p>libstephen has a standard way to deal with errors in code. Typically,
errors are reported in one of two ways in C code: * A status value is
returned, indicating the success of the function. * A pointer to a
status variable is provided, and is set to indicate the success of the
function.</p>
<p>libstephen takes the second approach.</p>
<div class="section" id="why-a-pointer-to-a-status-variable">
<h2>Why a pointer to a status variable?<a class="headerlink" href="#why-a-pointer-to-a-status-variable" title="Permalink to this headline">¶</a></h2>
<p>I thought long and hard about which approach to take, and I settled on
this for the following reasons:</p>
<ul class="simple">
<li>When a function returns a value, you expect it is a &#8220;result&#8221; of the
computation. Returning an error code makes it look like the error
code was something the function computed. This ruins the semantics of
the function signature.</li>
<li>Error codes on return values require reading the documentation on the
function <em>every time you call it</em>. Some may use -1 as the error code,
others may use 0, or NULL, or some other strategy. Plus, error return
values reduce the number of possible return values for the actual
result of the function (what if your function has a legitimate reason
to return -1?).</li>
<li>If a function returns a status, it is laughably easy to just <em>ignore</em>
it by not capturing the result of that expression. When it is an out
parameter, you <em>have</em> to create a variable to store it in, which
means no ignoring it.</li>
</ul>
</div>
<div class="section" id="values">
<h2>Values<a class="headerlink" href="#values" title="Permalink to this headline">¶</a></h2>
<p>The status variable type is just an <code class="docutils literal"><span class="pre">int</span></code>, but typedef&#8217;d to
<code class="docutils literal"><span class="pre">smb_status</span></code>. There are a handful of predefined error values:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">SMB_SUCCESS</span></code> - no error</li>
<li><code class="docutils literal"><span class="pre">SMB_INDEX_ERROR</span></code> - index error, for when you try to access an
index that doesn&#8217;t exist.</li>
<li><code class="docutils literal"><span class="pre">SMB_NOT_FOUND_ERROR</span></code> - hash key not found in hash table</li>
<li><code class="docutils literal"><span class="pre">SMB_STOP_ITERATION</span></code> - when an iterator stops iterating</li>
</ul>
</div>
<div class="section" id="memory-allocation-errors">
<h2>Memory allocation errors<a class="headerlink" href="#memory-allocation-errors" title="Permalink to this headline">¶</a></h2>
<p>Memory allocation errors are not included here. It&#8217;s nearly impossible
to recover from an out of memory error. The code to try to handle them
clutters up the library and program like none other. So, the standard
practice is to just exit when memory allocation fails.</p>
<p>In fact, libstephen provides helper functions for doing exactly this
when allocating memory. Here they are:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">type</span> <span class="pre">*smb_new(type,</span> <span class="pre">size_t</span> <span class="pre">amount)</span></code>: Allocates <code class="docutils literal"><span class="pre">amount</span></code> of memory of size
<code class="docutils literal"><span class="pre">size(type)</span></code>. Casts to the right pointer type for you. If there is an error,
prints a message to standard error and terminates with an error value. EG:</p>
<div class="code C highlight-c"><div class="highlight"><pre><span class="kt">char</span> <span class="o">*</span><span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;hi&quot;</span><span class="p">;</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">string</span> <span class="o">=</span> <span class="n">smb_new</span><span class="p">(</span><span class="kt">char</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="n">strncpy</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">);</span>   <span class="c1">//STDOUT: hi``</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">type</span> <span class="pre">*smb_renew(type,</span> <span class="pre">type</span> <span class="pre">*ptr,</span> <span class="pre">size_t</span> <span class="pre">newamt)</span></code> - Reallocates the
buffer to a new size, copying if necessary. Deals with errors for
you. EG:</p>
<div class="code C highlight-c"><div class="highlight"><pre><span class="n">string</span> <span class="o">=</span> <span class="n">smb_renew</span><span class="p">(</span><span class="kt">char</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="n">string</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;!&#39;</span><span class="p">;</span>
<span class="n">string</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">);</span>   <span class="c1">//STDOUT: hi!``</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">void</span> <span class="pre">smb_free(void</span> <span class="pre">*ptr)</span></code> - This actually doesn&#8217;t do any more than
<code class="docutils literal"><span class="pre">free()</span></code> does, but it seemed like it was necessary so that
everything felt aligned. EG:</p>
<div class="code C highlight-c"><div class="highlight"><pre><span class="n">smb_free</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="assertions">
<h2>Assertions<a class="headerlink" href="#assertions" title="Permalink to this headline">¶</a></h2>
<p>Finally, there are plenty of situations when an error should not occur,
but you still have to pass and check a status variable. In those
situations, <code class="docutils literal"><span class="pre">assert()</span></code> is your best friend. Use it only when an error
should never occur. If an error could occur, you should handle the
condition as part of the program logic, even if that means printing an
error message and terminating the program.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="arraylist.html" class="btn btn-neutral float-right" title="Array List (smb_al)" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Libstephen Tutorial" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2015, Stephen Brennan.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>